---
layout: post
date: 2017-05-17 16:46:43
categories: security
author_slug: jehyoung-lee
is_featured: false
feature_image: feature-ap.jpeg
---

공유기 분석을 좀 더 해보고 싶던 차에, (취약점이 나오지 않을까 하는 작은 소망과 함께) 저렴한 공유기를 사서 까보기 시작했다. 펌웨어 상으로만 봤을 때에는 Boa 서버와 BusyBox로 구성된 단순한 시스템이었고, 실제로 제품을 봐도 그런 것 같았다. 여기저기 만져보았는데, 역시 최근에 보안 패치를 했다더니 일단 막을 곳은 다 막혀있다. iptables 바이너리가 있는 것을 보고 방화벽에서 RCE가 터지지 않을 까 생각했으나, 웹서버 바이너리 분석결과 firewall.sh라는 파일에 일단 저장해 놓고, 다시 꺼내 쓰는 모양이다. 

다만, 의문인 점은 그렇다면 왜 몇몇 문자열들에 대해서는 필터링을 하고, 그 뒤로 사라지는가 하는 의문이 생긴다. 아마 이 부분에 대해서는 조금 더 연구를 거듭해 봐야 할 듯 하다.

일전에 KISA 발표에서 Boa기반 서버를 돌리는 공유기를 UPnP 취약점으로 RCE를 터뜨리는 것을 본적이 있어서 UPnP 데몬을 열어봤는데, 예전에 system 함수가 있던 자리에 왠걸, **FileWriteForKISA**라는 함수만 덩그러니 있다. 누가 이미 취약점 보고를 한건지 아님 개발사 쪽에서 자체점검을 잘 한건지 아리송했었는데, 저 함수를 본 순간, 아, 이건 이미 누가 취약점 분석을 한번 싹 했구나...라는 것을 깨달으며 약간 허탈한 기분이 들었다. 딱히 취약점이 대부분 패치되어 있어서가 아니라, 뭐라고 해야할까, 남이 짠 프로그램을 까보면서 취약점을 찾는 것은 마치 유물을 찾으러 다니는 모험가와 비슷한 기분인데, 이미 누군가가 유물을 다 가져가고 없으면 유물도 아쉽지만 개척한다는 듯한 기분이 사라져서 더욱 허탈한, 그런거랑 비슷한 느낌일 것이라 생각한다.

JTAG이나 UART 분석을 하는 것도 좋은 생각이었겠지만, 로직 애널라이저도 없고해서 더더욱이 JTAG DEBUGGER는 비싸니까, 포기하기로 했다. QEMU를 이용해서 돌려보는 것도 좋은 생각이라고 방금 떠올랐다. 밤이라서 머리가 둔해진 것일까... 슬슬 잠이나 자고 나머지는 휴일에 날을 잡아 같이 분석하기로 한 친구와 분석하는 것으로 해야 겠다.